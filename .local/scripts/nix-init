#!/usr/bin/env bash

set -e

template="${1:-default}"
flake_path="/etc/nix-darwin"

if ! nix flake init -t "$flake_path#$template" 2>/dev/null; then
  echo "Error: template '$template' not found"
  echo ""
  echo "Available:"
  nix flake show "$flake_path" 2>&1 | grep -E "^│.*└|^│.*├" | sed 's/.*[└├] /  /' || true
  exit 1
fi

echo "use flake" > .envrc
direnv allow

cat >> .gitignore << 'EOF'
# Nix
result
result-*

# direnv
.direnv/
EOF

echo "Initialized '$template' devshell"
