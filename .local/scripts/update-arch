#!/bin/bash

# Exit on error
set -e

# Check root
[[ $EUID -ne 0 ]] && {
  echo "Run as root"
  exit 1
}

# Snapshot
echo "Creating timeshift snapshot..."
if timeshift --create --comments "Pre-update $(date +%F_%T)" --scripted; then
  echo "✓ Snapshot created"
else
  echo "✗ Snapshot failed"
  exit 1
fi

# Update
echo "Updating system..."
if pacman -Syu --noconfirm; then
  echo "✓ Update complete"
else
  echo "✗ Update failed (snapshot available for rollback)"
  exit 1
fi

echo "Done."
